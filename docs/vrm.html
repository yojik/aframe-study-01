<!DOCTYPE html>

<html>

<head>
    <meta charset="utf-8" />
    <title>three-vrm + afrmae example</title>
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <style>
        body {
            margin: 0;
        }

        canvas {
            display: block;
        }
    </style>
</head>

<body>
    <script src="https://unpkg.com/three@0.126.1/build/three.js"></script>
    <script src="https://unpkg.com/three@0.126.1/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://unpkg.com/three@0.126.1/examples/js/controls/OrbitControls.js"></script>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="lib/three-vrm.js"></script>
    <script>
        // function animate() {
        //     requestAnimationFrame(animate);
        //     renderer.render(scene, camera);

        // }
        // animate();

        //VRMコンポーネント
        AFRAME.registerComponent('vrm', {
            schema: {},  // System schema. Parses into `this.data`.
            init: function () {
                let scene = document.querySelector('a-scene').object3D;
                // gltf and vrm
                const loader = new THREE.GLTFLoader();
                loader.crossOrigin = 'anonymous';
                loader.load(
                    // URL of the VRM you want to load
                    './models/three-vrm-girl.vrm',
                    // called when the resource is loaded
                    (gltf) => {
                        // calling this function greatly improves the performance
                        THREE.VRMUtils.removeUnnecessaryJoints(gltf.scene);
                        // generate VRM instance from gltf
                        THREE.VRM.from(gltf).then((vrm) => {
                            console.log(vrm);
                            vrm.humanoid.getBoneNode(THREE.VRMSchema.HumanoidBoneName.Hips).rotation.y = Math.PI;
                            scene.add(vrm.scene)
                        });
                        //https://github.com/mandel59/aframe-vrm/blob/three-vrm-issues-24/src/vrm-model.ts

                    },
                    // called while loading is progressing
                    (progress) => console.log('Loading model...', 100.0 * (progress.loaded / progress.total), '%'),

                    // called when loading has errors
                    (error) => console.error(error)

                );

            },
        });
    </script>

    <a-scene>
        <a-entity  vrm />
        <a-box position="-1 0.5 -3" rotation="0 45 0" color="#4CC3D9"></a-box>
        <a-sphere position="0 1.25 -5" radius="1.25" color="#EF2D5E"></a-sphere>
        <a-cylinder position="1 0.75 -3" radius="0.5" height="1.5" color="#FFC65D"></a-cylinder>
        <a-plane position="0 0 -4" rotation="-90 0 0" width="4" height="4" color="#7BC8A4"></a-plane>
        <a-sky color="#ECECEC"></a-sky>
    </a-scene>
</body>

</html>